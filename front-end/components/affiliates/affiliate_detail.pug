extends /site/detail

block instance
    -
        page.data({
            key: 'affiliate',
            title: 'affiliate',
            icon: "affiliates",
            impact_theme: "thm--affiliates",
            impact_color: "co--affiliates",
            
            location: 'affiliate_location',
            director_name: 'current_data.executive_director_name',
            director_email: 'current_data.executive_director_email',
            lead_name: 'current_data.program_lead_name',
            lead_email: 'current_data.program_lead_email',
        })


block premain
    include /posters/icon
        -
            vefa.data({ 
                    title: page.title.tag(),
                    icon: page.icon
            })
            .dom_mix({
                element: {
                    class: `thm--texture-tint ${page.impact_color}`,
                    "o-base":"ord--next",
                    "o-extended": "gxi--b"
                }
            })


append asset_controls
    +if(page.website.io())
        include /controls/action
            -
                vefa.data({
                    url: page.website.tag(),
                    label: `Website`,
                    external: true, 
                    icon: "link-ext"
                })
                .dom_mix({
                    element: {
                        class: "tx--small--f3--tcU rxn--ctrl-action",
                        "o-base": "iso--x"
                    }
                })


block detail_a
    include /cards/data-list--inverse
        -
            vefa
                .data({
                    heading: `Affiliate Information`,
                    items: [
                        ["mixin", "Executive Director", "card_exec"],
                        ["mixin", "Program Lead", "card_lead"],
                        ["text", "Location", page.location.io(), page.location.tag("choice_display:'AffiliateLocation'", 'capfirst')],
                        ["mixin", "Address", "card_contact"],
                        ["text", "Phone Number", page.phone_number.io()],               
                    ],
                })

        mixin card_contact
            ul
                li= page.address_street.tag()
                li= `${ page.address_city.tag() }, ${ page.address_state.tag() } ${ page.address_postcode.tag() }`
        
        mixin card_exec
            ul
                li= page.director_name.tag()
                li
                    a.tx--tdU.fx--shift(
                        href=`mailto:${ page.director_email.tag() }`
                    )
                        = page.director_email.tag()
        
        mixin card_lead
            ul
                li= page.lead_name.tag()
                li
                    a.tx--tdU.fx--shift(
                        href=`mailto:${ page.lead_email.tag() }`
                    )
                        = page.lead_email.tag()


block detail_b
    div(
        o-base="col--pStart pad--x25 rhy--yStart50"
        o-extended=" rhy--yStart100"
    )
        include /cards/data-list
            -
                vefa
                    .data({
                        heading: "Affiliate Resources",
                        items: [
                            ["money", "Annual Budget", 'eoy_data.budget_as_range'],
                            ['pct', 'Pct of Public Funding', 'eoy_data.funding_total and eoy_data.funding_public', `${v('eoy_data.funding_percent_public')}%`],
                            ['pct', 'Pct of Private Funding', 'eoy_data.funding_total and eoy_data.funding_private', `${v('eoy_data.funding_percent_private')}%`],
                        ]
                    })

        include /cards/data-list
            -
                vefa
                    .data({
                        heading: "Affiliate Staffing",
                        items: [
                            ["text", "Full-time", 'eoy_data.full_time_staff'],
                            ["text", "Part-time", 'eoy_data.part_time_staff'],
                            ["text", "Americorps", 'eoy_data.americorps_staff'],
                        ]
                    })
        
        include /cards/data-list
            -
                vefa
                    .data({
                        heading: "Affiliate Case Management Performance",
                        items: [
                            ['heading', 'Students in Grades Kâ€”11', 'eoy_data.students_k_11_promoted'],
                            ['text', 'Promoted', 'eoy_data.students_k_11_promoted'],
                            ['text', 'Retained', 'eoy_data.students_k_11_retained'],
                            ['text', 'Dropped Out', 'eoy_data.students_k_11_dropped_out'],
                            ['text', 'Transferred', 'eoy_data.students_k_11_transferred'],
                            ['text', 'GED', 'eoy_data.students_k_11_ged'],
                            ['text', 'Expelled', 'eoy_data.students_k_11_expelled'],
                            ['text', 'Incarcerated', 'eoy_data.students_k_11_incarcerated'],
                            ['text', 'Deceased', 'eoy_data.students_k_11_deceased'],
                            ['text', 'Other', 'eoy_data.students_k_11_other'],
                            ['text', 'Unknown', 'eoy_data.students_k_11_unknown'],
                            
                            ['heading', 'Students in Grade 12', 'eoy_data.students_grade_12_graduated'],
                            ['text', 'Graduated', 'eoy_data.students_grade_12_graduated'],
                            ['text', 'Retained', 'eoy_data.students_grade_12_retained'],
                            ['text', 'Dropped Out', 'eoy_data.students_grade_12_dropped_out'],
                            ['text', 'Transferred', 'eoy_data.students_grade_12_transferred'],
                            ['text', 'GED', 'eoy_data.students_grade_12_ged'],
                            ['text', 'Expelled', 'eoy_data.students_grade_12_expelled'],
                            ['text', 'Incarcerated', 'eoy_data.students_grade_12_incarcerated'],
                            ['text', 'Deceased', 'eoy_data.students_grade_12_deceased'],
                            ['text', 'Other', 'eoy_data.students_grade_12_other'],
                            ['text', 'Unknown', 'eoy_data.students_grade_12_unknown'],
                        ]
                    })

        
    div(
        o-base="col--pStart pad--x25 rhy--yStart50"
        o-extended="rhy--yStart100"
    )
        include /cards/data-list
            -
                vefa
                    .data({
                        heading: "School District Details",
                        items: [
                            ["group", "School District(s)", 'eoy_data.school_districts'],
                            ["text", "Total Enrollment", 'eoy_data.calculated_total_enrollment'],
                            ["text", "Number of Case-managed Students", 'eoy_data.calculated_total_case_managed'],
                            ["text", "Total Students Reached", 'eoy_data.calculated_total_students_reached'],
                        ]
                    })

        include /cards/card
            -
                vefa
                    .data({
                        heading: "By Race and Gender",
                        exists: "eoy_data.search_race or eoy_data.search_gender"
                    })

            mixin open_bd
                include /datagrids/base
                    -
                        vefa.data({
                                title: "Students By Race/ Ethnicity",
                                exists: "eoy_data.search_race",
                                items: [
                                    ['text', 'American Indian', 'eoy_data.search_students_american_indian'],
                                    ['text', 'Asian', 'eoy_data.search_students_asian'],
                                    ['text', 'Black', 'eoy_data.search_students_black'],
                                    ['text', 'Hispanic', 'eoy_data.search_students_hispanic'],
                                    ['text', 'White', 'eoy_data.search_students_white'],
                                    ['text', 'Two or More', 'eoy_data.search_students_two_or_more'],
                                    ['text', 'Other', 'eoy_data.search_students_other'],
                                ]
                            })
                            .dom_mix({
                                grid: {
                                    "o-extended": "gdx--gc2--gxy10"
                                }
                            })

                include /datagrids/base
                    -
                        vefa.data({
                                title: "Students By Gender",
                                exists: "eoy_data.search_gender",
                                items: [
                                    ['text', 'Male', 'eoy_data.search_students_male'],
                                    ['text', 'Female', 'eoy_data.search_students_female']
                                ]
                            })
                            .dom_mix({
                                grid: {
                                    "o-extended": "gdx--gc2--gxy10"
                                }
                            })

        
        include /cards/link-list
            -
                vefa
                    .data({
                        heading: "Active Programs",
                        heading_meta: "As reported in recent year's EOY data",
                        items: [
                            //- ["Test Link", "http://communities.org", "external_link"],
                            ["group", page.programs.io(), "programs"],
                        ], 
                    })


    +if('eoy_data.total_students_served > 0')
        div(
            o-base="col--pStart pad--x25 rhy--yStart50"
            o-extended="iso--yStart50 gxi--gs2"
        )
            include /cards/card
                -
                    vefa
                        .data({
                            heading: "Unique Student Characteristics",
                        })

                mixin open_bd
                    ul(
                        o-extended="gdx--gc6--gr2--gxy10"
                    )
                        -
                            items = [
                                ['FRPL Eligible Students Served', 'eoy_data.total_students_frpl > 0'],
                                ['ELL Students Served', 'eoy_data.total_students_ell > 0'],
                                ['Foster Care/Group Home', 'eoy_data.total_students_foster > 0'],
                                ['Homeless Youth', 'eoy_data.total_students_homeless > 0'],
                                ['LGBT', 'eoy_data.total_students_lgbt > 0'],
                                ['Pregnant/Parenting', 'eoy_data.total_students_pregnant_parenting > 0'],
                                ['Special Education', 'eoy_data.total_students_special_education > 0'],
                                ['Substance Abuse', 'eoy_data.total_students_substance_abuse > 0'],
                                ['Adjudicated Youth', 'eoy_data.total_students_adjudicated_youth > 0'],
                                ['Child of Military', 'eoy_data.total_students_child_of_military > 0'],
                                ['Gang Involvement', 'eoy_data.total_students_gang > 0'],
                                ['Incarcerated Parent', 'eoy_data.total_students_incarcerated_parent > 0'],
                            ]
                            
                        each item in items
                            +if(item[1])
                                li.thm--tint70.hl--yEnd--bCurrent.co--affiliates(
                                    o-base="col--pEnd--sStart"
                                    style="border-width: 2px"
                                )
                                    p.tx--maj--f3--100.co--copy(
                                        o-base="pad--xy25 iso--yStart200"
                                    )= item[0]
